<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style/style.css">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <title>Gas Sensor Details</title>
</head>
<body>
    <div class="container">
        <h1>Gas Details</h1>
        
        <!-- Conteneur pour les détails du capteur de lumière -->
        <div id="gas-details">
            <h2>Gas</h2>
            <p id="oxidising">Loading...</p>
            <p id="reducing">Loading...</p>
            <p id="nh3">Loading...</p>
            <p id="gas-date">Loading...</p>
        </div>

        <!-- Conteneur pour le graphique -->
        <div id="chart_div"></div>

        <!-- Bouton Retour -->
        <button id="back-button">Retour</button>
    </div>

    <script>
        // Charger la bibliothèque de visualisation et le package corechart.
        google.charts.load('current', { packages: ['corechart'] });

        // Callback pour charger le graphique une fois que la bibliothèque est chargée.
        google.charts.setOnLoadCallback(drawChart);

        let dataArray = [['Time', 'Oxidising', 'Reducing', 'NH3']];

        function getGas() {
            fetch('https://raspberrypi-fr.local:8050/gas', {headers: {'Accept': 'application/json'}})
                .then(response => response.json())
                .then(data => {
                    // Affichage des données dans la page
                    document.getElementById('oxidising').textContent = `Oxidising: ${data.oxidising} Ohms`;
                    document.getElementById('reducing').textContent = `Reducing: ${data.reducing} Ohms`;
                    document.getElementById('nh3').textContent = `NH3: ${data.nh3} Ohms`;
                    document.getElementById('gas-date').textContent = `Date: ${new Date(data.timestamp).toLocaleString()}`;

                    // Ajouter les nouvelles données au tableau
                    dataArray.push([new Date(data.timestamp), data.oxidising, data.reducing, data.nh3]);

                    // Redessiner le graphique avec les nouvelles données
                    drawChart();
                })
                .catch(error => console.error('Error fetching gas data:', error));
        }

        function drawChart() {
            let data = google.visualization.arrayToDataTable(dataArray);

            let options = {
                title: 'Gas Sensor Data',
                curveType: 'function',
                legend: { position: 'bottom' },
                hAxis: {
                    title: 'Time',
                    format: 'HH:mm:ss',
                    gridlines: { count: -1 }
                },
                vAxis: {
                    title: 'Resistance (Ohms)'
                }
            };

            let chart = new google.visualization.LineChart(document.getElementById('chart_div'));

            chart.draw(data, options);
        }

        getGas();
        setInterval(getGas, 1000);

        // Ajout d'un gestionnaire d'événements pour le bouton Retour
        document.getElementById('back-button').addEventListener('click', function() {
            // Redirection vers la page précédente
            history.back();
        });
    </script>
</body>
</html>
